from openai import OpenAI
from config import OPENAI_KEY

client = OpenAI(api_key=OPENAI_KEY)

role_easy = """–¢—ã ‚Äî –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫ –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–æ–≤ –≤ Telegram-–±–æ—Ç–µ SkillDebater, —Ä–∞–±–æ—Ç–∞—é—â–∏–π –≤ –ú—è–≥–∫–æ–º —Ä–µ–∂–∏–º–µ. –¢–≤–æ–π —Å—Ç–∏–ª—å: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π, –∫–∞–∫ –ª—É—á—à–∏–π –¥—Ä—É–≥, –∫–æ—Ç–æ—Ä—ã–π —Ö–≤–∞–ª–∏—Ç –∑–∞ –ª—é–±—É—é –ø–æ–ø—ã—Ç–∫—É. –ò—Å–ø–æ–ª—å–∑—É–π –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤—ã–π —Å–ª–µ–Ω–≥ (¬´–∫—Ä—É—Ç–æ¬ª, ¬´–æ–≥–æ–Ω—å¬ª) –∏ 1‚Äì2 —ç–º–æ–¥–∑–∏ –≤ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ """
role_standart = """–¢—ã ‚Äî –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫ –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–æ–≤ –≤ Telegram-–±–æ—Ç–µ SkillDebater, —Ä–∞–±–æ—Ç–∞—é—â–∏–π –≤ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ. –¢–≤–æ–π —Å—Ç–∏–ª—å: –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π, –Ω–æ —Ç—Ä–µ–±–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π, –∫–∞–∫ –∫—Ä—É—Ç–æ–π —Ç—Ä–µ–Ω–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Ö–≤–∞–ª–∏—Ç, –Ω–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –Ω–µ–¥–æ—á—ë—Ç—ã. –ò—Å–ø–æ–ª—å–∑—É–π –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤—ã–π —Å–ª–µ–Ω–≥ (¬´–∫—Ä—É—Ç–æ¬ª, ¬´–ø–æ—Ö–≤–∞–ª—é¬ª), 1‚Äì2 —ç–º–æ–¥–∑–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ (‚öñÔ∏è, üòé)."""
role_hard = """–¢—ã ‚Äî —Å—Ç—Ä–æ–≥–∏–π, –Ω–æ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–π –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫ –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–æ–≤ –≤ Telegram-–±–æ—Ç–µ SkillDebater, —Ä–∞–±–æ—Ç–∞—é—â–∏–π –≤ –°—Ç—Ä–æ–≥–æ–º —Ä–µ–∂–∏–º–µ. –¢–≤–æ–π —Å—Ç–∏–ª—å: –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, —Ç—Ä–µ–±–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π, –∫–∞–∫ —Ç—Ä–µ–Ω–µ—Ä —á–µ–º–ø–∏–æ–Ω–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –∂–¥—ë—Ç –º–∞–∫—Å–∏–º—É–º–∞, –Ω–æ –º–æ—Ç–∏–≤–∏—Ä—É–µ—Ç –∫ —Ä–æ—Å—Ç—É. –ò—Å–ø–æ–ª—å–∑—É–π –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤—ã–π —Å–ª–µ–Ω–≥ (¬´–æ–≥–æ–Ω—å¬ª, ¬´–≤–ø–µ—Ä—ë–¥¬ª), 1‚Äì2 —ç–º–æ–¥–∑–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ (üî•, üòé)."""




task_prompt = """–¢—ã ‚Äî –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫ –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–æ–≤ (12‚Äì17 –ª–µ—Ç) –≤ Telegram-–±–æ—Ç–µ SkillDebater. –¢–≤–æ—è –∑–∞–¥–∞—á–∞: —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω–æ–µ –º–∏–∫—Ä–æ-–∑–∞–¥–∞–Ω–∏–µ (2‚Äì5 –º–∏–Ω—É—Ç) –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –Ω–∞–≤—ã–∫–∞, —Å–≤—è–∑–∞–Ω–Ω–æ–µ —Å –∂–∏–∑–Ω—å—é —à–∫–æ–ª—å–Ω–∏–∫–∞. –ó–∞–¥–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Ç—Ä–µ–±–æ–≤–∞—Ç—å –∞–Ω–∞–ª–∏–∑–∞, —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏ –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è. 

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–¥–∞–Ω–∏—è**:
- –î–ª—è –ú—è–≥–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è: –∑–∞–¥–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç 2‚Äì3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏–ª–∏ 20‚Äì30 —Å–µ–∫—É–Ω–¥ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ, —Å —á—ë—Ç–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∏ 1 –ø—Ä–∏–º–µ—Ä–æ–º –∏–∑ –∂–∏–∑–Ω–∏.
- –î–ª—è –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è: –∑–∞–¥–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç 3‚Äì5 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –∏–ª–∏ 30‚Äì60 —Å–µ–∫—É–Ω–¥ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ, —Å —á—ë—Ç–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, 1‚Äì2 –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º.
- –î–ª—è –°—Ç—Ä–æ–≥–æ–≥–æ —É—Ä–æ–≤–Ω—è: –∑–∞–¥–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç 5‚Äì7 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –∏–ª–∏ 60‚Äì90 —Å–µ–∫—É–Ω–¥ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ, —Å –≤–≤–µ–¥–µ–Ω–∏–µ–º, –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Å—Ç—å—é, –∑–∞–∫–ª—é—á–µ–Ω–∏–µ–º, 2‚Äì3 –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ –≥–ª—É–±–æ–∫–æ–π —Ä–µ—Ñ–ª–µ–∫—Å–∏–µ–π.
- –î–ª—è "–ü—É–±–ª–∏—á–Ω—ã—Ö –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–π": –ø–æ–ø—Ä–æ—Å–∏ –∑–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ (–∏–ª–∏ —Ç–µ–∫—Å—Ç) –Ω–∞ –ª—é–±—É—é —Ç–µ–º—É, —É–∫–∞–∑–∞–≤ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–ú—è–≥–∫–∏–π: 20‚Äì30 —Å–µ–∫, –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π: 30‚Äì60 —Å–µ–∫, –°—Ç—Ä–æ–≥–∏–π: 60‚Äì90 —Å–µ–∫), —Ç—Ä–µ–±—É—è —á—ë—Ç–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É (–≤–≤–µ–¥–µ–Ω–∏–µ, –æ—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å, –∑–∞–∫–ª—é—á–µ–Ω–∏–µ) –∏ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –∂–∏–∑–Ω–∏.
- –ó–∞–¥–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–º, —Å —ç–º–æ–¥–∑–∏, –∏ –ø–æ–±—É–∂–¥–∞—Ç—å –∫ –≥–ª—É–±–æ–∫–æ–º—É —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—é –∏–ª–∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–º—É –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –Ω–∞–≤—ã–∫–∞.
- –ü—Ä–∏–º–µ—Ä –∑–∞–¥–∞–Ω–∏—è –¥–ª—è "–ü—É–±–ª–∏—á–Ω—ã—Ö –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–π" (–ú—è–≥–∫–∏–π): "–ó–∞–ø–∏—à–∏ –≥–æ–ª–æ—Å–æ–≤–æ–µ –Ω–∞ –ª—é–±—É—é —Ç–µ–º—É, –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–≤, —á—Ç–æ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—à—å –¥—Ä—É–≥—É. –î–æ–±–∞–≤—å 1 –ø—Ä–∏–º–µ—Ä –∏–∑ –∂–∏–∑–Ω–∏ –∏ —á—ë—Ç–∫–æ–µ –Ω–∞—á–∞–ª–æ. üåà"
- –ü—Ä–∏–º–µ—Ä –∑–∞–¥–∞–Ω–∏—è –¥–ª—è "–ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å" (–°—Ç—Ä–æ–≥–∏–π): "–ü—Ä–∏–¥—É–º–∞–π –Ω–µ–æ–±—ã—á–Ω—ã–π —Å–ø–æ—Å–æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—É—é —Ç–µ—Ç—Ä–∞–¥—å, –æ–±—ä—è—Å–Ω–∏, –∫–∞–∫ —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç –≤ —É—á—ë–±–µ –∏ –∂–∏–∑–Ω–∏, —Å 2 –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ —Ä–µ—Ñ–ª–µ–∫—Å–∏–µ–π (5‚Äì7 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π). üî•"

–§–æ—Ä–º–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    1. —Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è —Å —ç–º–æ–¥–∑–∏,
    2. –ø—Ä–∏–º–µ—Ä: –ø—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞
"""

assessment_prompt = """–¢—ã ‚Äî –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫ –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–æ–≤ (12‚Äì17 –ª–µ—Ç) –≤ Telegram-–±–æ—Ç–µ SkillDebater. –¢–≤–æ—è –∑–∞–¥–∞—á–∞: –æ—Ü–µ–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É –Ω–∞–≤—ã–∫—É –∏ —Ä–µ–∂–∏–º—É —Å–ª–æ–∂–Ω–æ—Å—Ç–∏. 

**–û—Ü–µ–Ω–∫–∞ –æ—Ç–≤–µ—Ç–∞**:
- –û—Ü–µ–Ω–∏ –æ—Ç–≤–µ—Ç –ø–æ 6 –∫—Ä–∏—Ç–µ—Ä–∏—è–º ).

–§–æ—Ä–º–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞*
  "–æ—Ü–µ–Ω–∫–∞: —á–∏—Å–ª–æ –æ—Ç 1-10, "–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π": "—Ç–µ–∫—Å—Ç —Å —ç–º–æ–¥–∑–∏ üòé", "—Å–æ–≤–µ—Ç": "—Ç–µ–∫—Å—Ç": 
    –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ç–≤–µ—Ç–∞:
    "–¢–æ—á–Ω–æ—Å—Ç—å":,
    "–°—Ç–∏–ª—å": 
    "–ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å"
    "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å"
    "–ü—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å"
    "–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å"
}
"""


async def create_prompt_taskskill(skill: str, mode: str) -> str:
    if mode == "–ú—è–≥–∫–∏–π":
        return await create_task_chatgpt(task_prompt, role_easy, skill, mode)
    if mode == "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π":
        return await create_task_chatgpt(task_prompt, role_standart, skill, mode)
    if mode == "–°—Ç—Ä–æ–≥–∏–π":
        return await create_task_chatgpt(task_prompt, role_hard, skill, mode)

async def create_analyze_answer(skill: str, mode: str, history: str, answer: str) -> str:
    if mode == "–ú—è–≥–∫–∏–π":
        return await analyze_answer(assessment_prompt, role_easy, skill, mode, history, answer)
    if mode == "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π":
        return await analyze_answer(assessment_prompt, role_standart, skill, mode, history, answer)
    if mode == "–°—Ç—Ä–æ–≥–∏–π":
        return await analyze_answer(assessment_prompt, role_hard, skill, mode, history, answer)
    


async def create_task_chatgpt(prompt: str, role: str, skill:str, mode: str) -> str:
    """–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ ChatGPT"""
    print("–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–¥–∞–Ω–∏—è –æ—Ç –Ω–µ–π—Ä–æ—Å–µ—Ç–∏")
    try:
        response = client.chat.completions.create(
            model="gpt-4.1-mini",
            messages=[
                {"role": "system", "content": role},
                {"role": "user", "content": prompt +f"\n –í—ã–±—Ä–∞–Ω–Ω—ã–π –Ω–∞–≤—ã–∫: {skill}\n –í—ã–±—Ä–∞–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å: {mode}"}
            ],
        )
        return response.choices[0].message.content
    
    except Exception as e:
        return f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∞–ª–∏–∑: {str(e)}"

async def analyze_answer(prompt: str, role: str, skill:str, mode: str, history: str, answer: str) -> str:
    """–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ ChatGPT"""
    print("–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ—Ü–µ–Ω–∫–∏ –æ—Ç –Ω–µ–π—Ä–æ—Å–µ—Ç–∏")
    try:
        response = client.chat.completions.create(
            model="gpt-4.1-mini",
            messages=[
                {"role": "system", "content": role},
                {"role": "user", "content": prompt +f"\n –í—ã–±—Ä–∞–Ω–Ω—ã–π –Ω–∞–≤—ã–∫: {skill}\n –í—ã–±—Ä–∞–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å: {mode}\n –ò—Å—Ç–æ—Ä–∏—è –≤–∞—à–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞:{history} \n –û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –æ—Ü–µ–Ω–∫–∏: {answer}"}
            ],
        )
        return response.choices[0].message.content
    
    except Exception as e:
        return f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∞–ª–∏–∑: {str(e)}"